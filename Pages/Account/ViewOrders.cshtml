@page
@using FlowerShop.Data.Models
@using FlowerShop.Dto.DTOGet
@model FlowerShop.Web.Pages.Account.ViewOrdersModel

<div class="container">
    <a asp-page="/Account/Profile" class="back-link">← Вернуться назад</a>

    <div class="content">
        <h1 class="content__main">Мои заказы</h1>
        <p class="content__description">Отслеживайте свою историю заказов</p>
    </div>

    <div class="grid">
        @if (Model.Orders.Any())
        {
            @foreach (var order in Model.Orders)
            {
                var item = order.OrderItem.FirstOrDefault();
                var bouquet = item?.Bouquet;

                <article class="cart-item">
                    <img class="cart-item__img" src="@Url.Content(bouquet?.ImagePath)" alt="@bouquet?.Name" />

                    <div class="cart-item__info">
                        <h2 class="cart-item__title">@bouquet?.Name</h2>

                        <div class="label">Order ID</div>
                        <div class="value">@bouquet?.Id</div>

                        <div class="label">Дата получения</div>
                        <div class="value">@order.PickupDate.ToString("yyyy-MM-dd")</div>

                        <div class="label">Статус</div>
                        <div class="value">
                            @if (order.Status.ToString().ToLower() == "complated")
                            {
                                <span class="verified">Доставлен</span>
                            }
                            else
                            {
                                <!-- простая метка без доп. CSS -->
                                <span>@order.Status</span>
                            }
                        </div>
                    </div>

                    <div class="cart-item__total">
                        $@order.TotalAmount
                    </div>

                    <div class="cart-item__remove">
                        <div class="grid" style="gap:8px;">
                            <a class="btn btn--brand">Подробнее</a>
                            <a class="btn btn--outline-pink">Повторить заказ</a>
                        </div>
                    </div>
                </article>
            }
        }
        else
        {
            <div class="cart-empty">
                <img class="cart-empty__img" src="/images/empty.png" alt="">
                <h3 class="cart-empty__title">Пока нет заказов</h3>
                <p class="cart-empty__text">Соберите первый букет — это быстро и приятно.</p>
                <a asp-page="/Index" class="btn btn--brand cart-summary__checkout">Перейти к букетам</a>
            </div>
        }
    </div>

    @{
        var delivered = Model.Orders.Count(o => (o.Status.ToString()).ToLower() == "complated");
        var active = Model.Orders.Count - delivered;
    }
    <div class="profile-card" style="margin-top:20px;">
        <h3 style="margin:0 0 12px;">Краткое описание заказов</h3>
        <div class="grid" style="grid-template-columns: repeat(3,1fr); gap:10px; text-align:center;">
            <div>
                <div class="orders-count">@Model.Orders.Count</div>
                <div class="orders-caption">Всего заказов</div>
            </div>
            <div>
                <div class="orders-count">@delivered</div>
                <div class="orders-caption">Доставлено</div>
            </div>
            <div>
                <div class="orders-count">@active</div>
                <div class="orders-caption">Активные</div>
            </div>
        </div>
    </div>
</div>

